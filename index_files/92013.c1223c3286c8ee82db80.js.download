"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[92013],{781298:(e,t,i)=>{i.d(t,{AbstractFilledAreaPaneView:()=>p});var s=i(650151),l=(i(86441),i(5531),i(828473)),o=i(448874),n=i(432059),a=i(211414);var r=i(114555),d=i(181530);function h(e,t){return Array.from({length:e},((e,i)=>({timePointIndex:i+t})))}function c(e,t,i){let s,l;const o=e.length;for(let n=t;n>=0&&n<o;n+=i){const t=e[n];if(void 0===s&&void 0!==t.plot1Value&&(s=n),void 0===l&&void 0!==t.plot2Value&&(l=n),void 0!==s&&void 0!==l)return n}return null}function u(e){return 0===e.type?`${e.color}`:`${e.color1}:${e.color2}:${e.coordinate1}:${e.coordinate2}`}const _={type:0,color:""};class p{constructor(e,t,i){this._isHlineFill=!1,this._bandAKey=null,this._bandBKey=null,this._colorPlotIndex=null,this._areaRenderer=new r.AreaBackgroundRenderer,this._dataInvalidated=null,this._viewportInvalidated=!1,this._plIndex1=null,this._plIndex2=null,this._items=[],this._colorAreas=new r.CachedMap,this._generateColor=function(e=1e3){const t=o.default.Cache;o.default.Cache=a.CircularCacheBuffer.bind(a.CircularCacheBuffer,e);const i=(0,o.default)(n.generateColor,((e,t,i)=>`${e}_${t}_${i}`));return o.default.Cache=t,i}(),this._source=e,this._model=t,this._fillGaps=!!(null==i?void 0:i.fillgaps),this._fillToIntersection=!!(null==i?void 0:i.fillToIntersection)}update(e){if("global-change"===e.type)return this._dataInvalidated=(0,d.mergeDataInvalidation)(this._dataInvalidated,{}),void(this._viewportInvalidated=!0);if("data-source-change"!==e.type)this._viewportInvalidated=!0;else{e.sourceId===this._source.id()&&(this._dataInvalidated=(0,d.mergeDataInvalidation)(this._dataInvalidated,{firstIndex:e.firstUpdatedTimePointIndex,clearData:e.clearData}))}}renderer(){return this._dataInvalidated?this._updateImplFull(this._dataInvalidated)&&(this._dataInvalidated=null,this._viewportInvalidated=!1):this._viewportInvalidated&&(this._updateImplLight(),this._viewportInvalidated=!1),this._areaRenderer}_minFirstBarIndex(){return-1/0}_priceScale(){return this._source.priceScale()}_firstValue(){return this._source.firstValue()}_plotNames(){return this._source.metaInfo().plots.map((e=>e.id))}_plotIndex1(){return null===this._plIndex1&&(this._plIndex1=this._plotNames().indexOf(this._plotAId())+1),this._plIndex1}_plotIndex2(){return null===this._plIndex2&&(this._plIndex2=this._plotNames().indexOf(this._plotBId())+1),this._plIndex2}_updateImplFull(e){var t,i,o,n;if(this._areaRenderer.setData(null),(null===(t=this._dataInvalidated)||void 0===t?void 0:t.clearData)&&(this._items=[]),!this._visible())return!1;if(null===this._priceScale())return!1;if(null===this._firstValue())return!1;const a=this._source.plots().plottableRange(),r=a.size();if(0===r)return!1;const d=this._source.offset(this._plotAId()),c=this._source.offset(this._plotBId()),u=Math.min(d,c),_=Math.max(d,c);let p=e.firstIndex;const m=r+(_-u)+1,v=this._plotIndex1(),I=this._plotIndex2();m!==this._items.length&&(void 0===p||0===this._items.length||p<this._items[0].timePointIndex+u?(p=void 0,
this._items=h(m,1e10)):this._items=this._items.concat(h(m-this._items.length,1e10+this._items.length)));const y=this._colorPlotIndex,f=this._transparency(),x=void 0===p?a.fullRangeIterator():a.rangeIterator(p,(0,s.ensureNotNull)(a.lastIndex()));let g=void 0!==p?(0,l.lowerbound)(this._items,p+u,((e,t)=>e.timePointIndex<t))-u:-u;for(const e of x){const t=e.index+d,s=e.index+c,l=this._items[g+d],a=this._items[g+c];if(l.timePointIndex=t,a.timePointIndex=s,this._isHlineFill||(l.plot1Value=null!==(i=e.value[v])&&void 0!==i?i:void 0,a.plot2Value=null!==(o=e.value[I])&&void 0!==o?o:void 0),null!==y){const t=g+u-1;if(t>=0&&t<this._items.length){const i=this._items[t];let s;s=0===y.type?{type:0,colorIndexOrRgba:e.value[y.colorIndexOrRgba+1]}:{type:1,colorIndexOrRgba1:void 0===y.colorIndexOrRgba1?void 0:e.value[y.colorIndexOrRgba1+1],colorIndexOrRgba2:void 0===y.colorIndexOrRgba2?void 0:e.value[y.colorIndexOrRgba2+1],value1:void 0===y.valueIndex1?void 0:e.value[y.valueIndex1+1],value2:void 0===y.valueIndex2?void 0:e.value[y.valueIndex2+1]};const l=i.color=null!==(n=this._getColorByPlotValue(s))&&void 0!==n?n:void 0;void 0!==l&&(1===l.type?(l.color1=l.color1&&this._generateColor(l.color1,f),l.color2=l.color2&&this._generateColor(l.color2,f)):l.color=this._generateColor(l.color,f))}}g+=1}return this._updateImplLight(),!0}_updateImplLight(){var e,t,i,o;if(!this._visible())return;const n=this._priceScale();if(null===n)return;const a=this._firstValue();if(null===a)return;if(0===this._items.length)return;let d;if(this._isHlineFill){const e=this._source.properties().bands[(0,s.ensureNotNull)(this._bandAKey)],t=this._source.properties().bands[(0,s.ensureNotNull)(this._bandBKey)];d={level1:n.priceToCoordinate(e.value.value(),a),level2:n.priceToCoordinate(t.value.value(),a)}}const h=this._model.timeScale(),p=h.visibleBarsStrictRange();if(null===p)return;const m=n.priceToCoordinateFn(a),v=this._transparency(),I=this._minFirstBarIndex(),y=Math.max(I,p.firstBar()),f=(0,l.lowerbound)(this._items,y,((e,t)=>e.timePointIndex<t));if(f>=this._items.length)return;const x=Math.min(this._items.length-1,(0,l.lowerbound)(this._items,p.lastBar(),((e,t)=>e.timePointIndex<t)));let g,S;this._isHlineFill?(g=I===y?f:Math.max(0,f-1),S=Math.min(this._items.length-1,x+1)):(g=I===y?f:null!==(e=c(this._items,f-1,-1))&&void 0!==e?e:f,S=null!==(t=c(this._items,x+1,1))&&void 0!==t?t:x);const P=this._colorAreas;P.invalidateCache();let b,w=null,C=null,N=null;const L=this._commonColor();let R;1===L.type?(L.coordinate1=m(L.value1),L.coordinate2=m(L.value2),L.color1=L.color1&&this._generateColor(L.color1,v),L.color2=L.color2&&this._generateColor(L.color2,v)):L.color=this._generateColor(L.color,v);for(let e=g;e<=S;e+=1){const t=this._items[e],s=t.timePointIndex;let l,n;!this._fillGaps&&void 0!==R&&s-R>1&&(w=null),void 0!==d?(l=d.level1,n=d.level2):(l=t.plot1Coordinate=void 0===t.plot1Value?void 0:m(t.plot1Value),n=t.plot2Coordinate=void 0===t.plot2Value?void 0:m(t.plot2Value));const a=t.xCoordinate=h.indexToCoordinate(t.timePointIndex)
;if(t.color&&1===t.color.type&&(t.color.coordinate1=m(t.color.value1),t.color.coordinate2=m(t.color.value2)),this._fillGaps?void 0!==l||void 0!==n:void 0!==l&&void 0!==n){const s=null!==this._colorPlotIndex?t.color||_:L;if(M=s,!(null===(B=N)||null===M?B===M:0===B.type&&0===M.type?B.color===M.color:1===B.type&&1===M.type&&B.color1===M.color1&&B.color2===M.color2&&B.coordinate1===M.coordinate1&&B.coordinate2===M.coordinate2)||null===w){if(null!==w&&(void 0!==l&&w.addPoints1Point(a,l),void 0!==n&&w.addPoints2Point(a,n)),e===S)continue;N=s;const t=u(s),d=null!==(i=P.get(t))&&void 0!==i?i:new r.AreaBackgroundItemsGroup(s);C=w,w=null!==(o=d.newItem())&&void 0!==o?o:new r.AreaBackgroundItem,d.push(w),P.set(t,d)}void 0!==l&&w.addPoints1Point(a,l),void 0!==n&&w.addPoints2Point(a,n)}else this._fillGaps||(N=null,w=null,C=null);R=s,b=t}var B,M;P.delete(u(_));const D={barSpacing:this._model.timeScale().barSpacing(),colorAreas:P};this._areaRenderer.setData(D)}}},512230:(e,t,i)=>{i.d(t,{AreaBackgroundPaneView:()=>o});var s=i(650151),l=i(781298);class o extends l.AbstractFilledAreaPaneView{constructor(e,t){super(e,t)}_plotAId(){return(0,s.ensureDefined)(this._source.metaInfo().area)[0].name}_plotBId(){return(0,s.ensureDefined)(this._source.metaInfo().area)[1].name}_commonColor(){return{type:0,color:this._source.properties().areaBackground.backgroundColor.value()}}_transparency(){var e,t;return null!==(t=null===(e=this._source.properties().areaBackground.transparency)||void 0===e?void 0:e.value())&&void 0!==t?t:0}_visible(){return this._source.properties().areaBackground.fillBackground.value()}_getColorByPlotValue(e){return this._commonColor()}}},181530:(e,t,i)=>{function s(e,t){if(null===e)return t;const i=e.firstIndex,s=t.firstIndex,l=e.clearData||t.clearData;return{firstIndex:l||void 0===i||void 0===s?void 0:Math.min(i,s),clearData:l}}i.d(t,{mergeDataInvalidation:()=>s})},703614:(e,t,i)=>{i.d(t,{StudyPlotPaneView:()=>A});var s=i(650151),l=i(724377),o=i(764829),n=i(750139),a=i(124829),r=i(432059),d=i(387964),h=i(199872),c=i(403862),u=i(982949),_=i(708698),p=i(810873),m=i(112377),v=i(40563),I=i(296842),y=i(86441),f=i(286436),x=i(509078),g=i(961970),S=i(638456);class P extends g.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){var t,i,s,l;const o=this._data,n=o.lineWidth,a=o.vertOffset||0,r=(0,f.interactionTolerance)().series+n,d=null!==(i=null===(t=o.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,h=null!==(l=null===(s=o.visibleItemsRange)||void 0===s?void 0:s.endItemIndex)&&void 0!==l?l:o.items.length;for(let t=d;t<h;t++){const i=o.items[t];if(new y.Point(i.center,i.y+a).subtract(e).length()+n<=r)return new x.HitTestResult(x.HitTarget.Regular)}return null}_drawImpl(e){var t,i,s,l;const o=this._data,{horizontalPixelRatio:n,verticalPixelRatio:r,context:d}=e,h=Math.max(1,Math.floor(n))%2?.5:0,c=o.vertOffset||0,u=o.lineColor,_=o.lineWidth;let p="",m=!1
;const v=null!==(i=null===(t=o.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,I=null!==(l=null===(s=o.visibleItemsRange)||void 0===s?void 0:s.endItemIndex)&&void 0!==l?l:o.items.length;for(let e=v;e<I;e++){const t=o.items[e],i=t.center,s=t.y+c;if((0,a.isNaN)(i)||(0,a.isNaN)(s))continue;let l,v;null!=t.style?(l=t.style.color,v=t.style.width):(l=u,v=_),(l!==p||S.isSafari)&&(p=l,m&&d.fill(),d.beginPath(),d.fillStyle=l);const I=Math.round(i*n)+h,y=Math.round(s*r)+h,f=Math.round(v*n)+h;d.moveTo(I+f,y),d.arc(I,y,f,0,2*Math.PI,!1),m=!0}m&&d.fill()}}var b=i(559678),w=i(204652);class C extends g.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){const t=(0,f.interactionTolerance)().series+this._data.lineWidth/2;let i,s,l,o;for(let n=1;n<this._data.items.length;++n){i=this._data.items[n-1],s=this._data.items[n],l=i.center,o=s.center;if((0,w.distanceToSegment)(new y.Point(l,i.y),new y.Point(o,s.y),new y.Point(e.x,e.y)).distance<=t)return new x.HitTestResult(x.HitTarget.Regular)}return null}_drawImpl(e){var t,i,s,l,o,n,r,d;const{context:h,horizontalPixelRatio:c,verticalPixelRatio:u}=e;let _="",p=!1;const m=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,v=(null!==(l=null===(s=this._data.visibleItemsRange)||void 0===s?void 0:s.endItemIndex)&&void 0!==l?l:this._data.items.length)-1;for(let e=m;e<=v;e++){const t=this._data.items[e];if((0,a.isNaN)(t.center)||(0,a.isNaN)(t.y))continue;const i=null!==(n=null===(o=t.style)||void 0===o?void 0:o.color)&&void 0!==n?n:this._data.lineColor,s=null!==(d=null===(r=t.style)||void 0===r?void 0:r.width)&&void 0!==d?d:this._data.lineWidth,l=Math.max(1,Math.floor(s*c)),m=Math.max(1,Math.floor(s*u));(i!==_||S.isSafari)&&(_=i,p&&h.fill(),h.beginPath(),h.fillStyle=i);let v=3*l;v%2!=l%2&&(v+=1);let I=3*m;I%2!=m%2&&(I+=1);const y=Math.round(Math.round(t.center*c)-v/2),f=Math.round(Math.round(t.y*u)-I/2),x=y+Math.floor(v/2-l/2),g=f+Math.floor(I/2-m/2);h.rect(y,g,v,m),h.rect(x,f,l,I),p=!0}p&&h.fill()}}class N extends g.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e){const t=(0,f.interactionTolerance)().series+this._data.lineWidth/2,i=new Map;for(const l of this._data.items){const o=l.center,n=l.y;let a=t;l.style&&(i.has(l.style.width)?a=(0,s.ensureDefined)(i.get(l.style.width)):i.set(this._data.lineWidth,a));if((0,w.distanceToSegment)(new y.Point(o,n),new y.Point(o,this._data.histogramBase),new y.Point(e.x,e.y)).distance<=a)return new x.HitTestResult(x.HitTarget.Regular)}return null}_drawImpl(e){var t,i,s,l;if(0===this._data.items.length)return;const{context:o,horizontalPixelRatio:n,verticalPixelRatio:a}=e;o.fillStyle=this._data.lineColor
;const r=Math.max(1,Math.floor(this._data.lineWidth*n)),d=r/2,h=Math.max(1,Math.floor(n)),c=Math.round(this._data.histogramBase*a)-Math.floor(h/2),u=c+h,_=null!==(i=null===(t=this._data.visibleItemsRange)||void 0===t?void 0:t.startItemIndex)&&void 0!==i?i:0,p=(null!==(l=null===(s=this._data.visibleItemsRange)||void 0===s?void 0:s.endItemIndex)&&void 0!==l?l:this._data.items.length)-1;for(let e=_;e<=p;e++){const t=this._data.items[e];let i=r,s=d;t.style?(o.fillStyle=t.style.color,i=Math.max(1,Math.floor(t.style.width*n)),s=i/2):o.fillStyle=this._data.lineColor;const l=i%2?.5:0,_=Math.round(t.center*n)+l,p=Math.round(t.y*a);let m,v;p<=c?(m=p,v=u):(m=c,v=p-Math.floor(h/2)+h),o.fillRect(Math.floor(_-s),m,i,v-m)}}}var L=i(748947),R=i(962973),B=i(828473),M=i(337827);const D=e=>{const t=(0,l.rgbToHsl)((0,l.parseRgb)(e)),i=t[0]+.05;return t[0]=i-Math.floor(i),(0,l.rgbToHexString)((0,l.hslToRgb)(t))},V=(0,h.memoize)(D),T=new Set([L.LineStudyPlotStyle.Line,L.LineStudyPlotStyle.Area,L.LineStudyPlotStyle.Circles,L.LineStudyPlotStyle.Cross,L.LineStudyPlotStyle.StepLine,L.LineStudyPlotStyle.StepLineWithDiamonds]);class A extends M.StudyPaneViewInplaceUpdatable{constructor(e,t,i,s,l=!1){super(t,i,s),this._histogramBase=null,this._lineColor="",this._lineWidth=1,this._color1="",this._color2="",this._renderer=new u.CompositeRenderer,this._isMarkersEnabled=o.enabled("source_selection_markers"),this._study=e,this._plotIndex=e.metaInfo().plots.findIndex((e=>e.id===s)),this._colorProvider=(0,R.createStudyPlotColorProvider)(e.metaInfo(),e.properties(),s),this._extendStepLineToBarsEndings=l,this._isFundamental=(0,I.isFundamentalStudyMetaInfo)(e.metaInfo());const n=this._study.properties().styles[this._plotName].plottype.value();this._isStepLinePlot=n===L.LineStudyPlotStyle.StepLine||n===L.LineStudyPlotStyle.StepLineWithBreaks||n===L.LineStudyPlotStyle.StepLineWithDiamonds}items(){return this._items}renderer(){return this._makeSureRendererIsValid(),this._renderer}_getTranspValue(){const e=this._study.properties(),t=e.styles[this._plotName];let i=0;const s=this._study.metaInfo();return"Volume@tv-basicstudies"===s.id&&s.version<=46&&"transparency"in e?(i=e.transparency.value(),i=(0,a.isNumber)(i)?i:0,i):(t.transparency&&(i=t.transparency.value(),i=(0,a.isNumber)(i)?i:0),i)}_updateImplFull(e){var t,i,l;if(this._renderer.clear(),(null===(t=this._dataInvalidated)||void 0===t?void 0:t.clearData)&&(this._items=[]),!this._study.isPlotVisibleAt(this._plotName,1))return!1;const o=this._study.priceScale();if(!o||o.isEmpty())return!1;if(null===this._study.firstValue(void 0,this.isForceOverlay()))return!1;this._histogramBase=null;const a=this._study.properties().styles[this._plotName],h=a.plottype.value(),c=this._isFundamental&&this._isStepLinePlot,u=this._study.plots().plottableRange(c);if(0===u.size())return!1;const _=this._study.offset(this._plotName),p=T.has(h),m=this._preallocateItems(u,((e,t)=>({y:NaN,left:NaN,center:NaN,right:NaN,origPrices:{price:null!=t?t:NaN,timePointIndex:e+_},timePointIndex:e+_})));let I=NaN,y=NaN;const f=new Map,x=(e,t)=>{
let i=f.get(e);void 0===i&&(i=new Map,f.set(e,i));let s=i.get(t);if(void 0===s){const l=!this._plotName||"vol"!==this._plotName;s=(0,r.generateColor)(e,t,l),i.set(t,s)}return s},g=(0,v.createEmptyStyle)(),S=(0,n.clamp)(this._getTranspValue(),0,100),P=this._model.timeScale().visibleBarsStrictRange();if(null===P)return!1;const{startBar:b,endBar:w}=this._calculateStartEnd(P);if(null===b||null===w||0===this._items.length)return!1;const C=null!=m?m:(0,s.ensureNotNull)(u.firstIndex()),N=(0,s.ensureNotNull)(u.lastIndex())+1,L=u.rangeIterator(C,N);let R,M=(0,B.lowerbound)(this._items,C+_,((e,t)=>e.timePointIndex<t));for(const e of L){let t=e.index;const s=e.value;t+=_,t=Math.floor(t);let o=s[this._plotIndex+1];const n=null==o;if(o=n?NaN:o,p&&n){y=o,I=t,M++;continue}const d=this._items[M];d.valIsNotSameAsPrev=o!==y||t-1!==I;if(this._colorProvider.isColorDefined()&&(d.style={color:x(a.color.value(),100),width:a.linewidth.value(),style:a.linestyle.value()},null!=o)){const e=this._colorProvider.getPlotPointStyle(s,g),t=e.colors[0];void 0!==t&&(d.style.color=(0,r.isHexColor)(t)?x(t,S):t),d.style.width=null!==(i=e.lineWidth)&&void 0!==i?i:d.style.width,d.style.style=null!==(l=e.lineStyle)&&void 0!==l?l:d.style.style}!p&&!isNaN(I)&&I!==t-1&&M>0&&(this._items[M].breakBefore=!0),y=o,I=t,M++,R=d}if(R&&this._isFundamental&&this._isStepLinePlot){const e=this._model.mainSeries().data().bars().lastIndex(),t=R;if(null!==e&&e>t.timePointIndex){const i=(0,d.deepCopy)(t);i.timePointIndex=e,i.valIsNotSameAsPrev=!1,this._items.length>M?this._items[M]=i:this._items.push(i)}}return this._updateImplLight(),!0}_correctVisibleItemIndexes(e,t){const i=super._correctVisibleItemIndexes(e,t);return this._isFundamental&&this._isStepLinePlot&&i.endItemIndex===this._items.length-1&&(i.endItemIndex+=1),i}_updateRenderer(e,t){var i,l;this._renderer.clear();const o=this._study.properties().styles.childs()[this._plotName].childs(),h=null===(i=this._study.metaInfo().styles)||void 0===i?void 0:i[this._plotName],u=(0,n.clamp)(this._getTranspValue(),0,100);this._lineColor=(0,r.generateColor)(o.color.value(),u),this._lineWidth=o.linewidth.value();let v=o.color.value();const I=this._colorProvider.getDefaultPlotPointStyle();I&&(v=I.colors[0]||v,this._lineWidth=null!==(l=I.lineWidth)&&void 0!==l?l:this._lineWidth,this._lineColor=v?(0,r.generateColor)(v,u):this._lineColor),this._color2=(0,r.generateColor)(v,u);const y=this._study.metaInfo().isRGB?D(v):V(v);this._color1=(0,r.generateColor)(y,u);const f=this._histogramBase?this._histogramBase:(0,s.ensureNotNull)(this._study.priceScale()).height(),x=o.plottype.value(),g={barSpacing:this._model.timeScale().barSpacing(),items:this._items,histogramBase:f,lineIndex:0,lineStyle:o.linestyle.value(),lineColor:this._lineColor,lineWidth:(0,a.isNumber)(this._lineWidth)?this._lineWidth:1,color1:this._color1,color2:this._color2,bottom:f,visibleItemsRange:{startItemIndex:e,endItemIndex:t},simpleMode:this._colorProvider.singleColor(),
skipHoles:[L.LineStudyPlotStyle.Line,L.LineStudyPlotStyle.Area,L.LineStudyPlotStyle.Cross,L.LineStudyPlotStyle.Circles,L.LineStudyPlotStyle.StepLine,L.LineStudyPlotStyle.StepLineWithDiamonds].includes(x)},S=this._renderer,w=Boolean(null==h?void 0:h.joinPoints);switch(x){case L.LineStudyPlotStyle.Line:case L.LineStudyPlotStyle.LineWithBreaks:S.append(new _.PaneRendererLine(g));break;case L.LineStudyPlotStyle.Area:case L.LineStudyPlotStyle.AreaWithBreaks:S.append(new c.PaneRendererArea(g));break;case L.LineStudyPlotStyle.Histogram:S.append(new N(g));break;case L.LineStudyPlotStyle.Columns:S.append(new b.PaneRendererColumns(g));break;case L.LineStudyPlotStyle.Cross:S.append(new C(g)),w&&S.append(new _.PaneRendererLine({...(0,d.deepCopy)(g),lineWidth:1,forceLineWidth:!0}));break;case L.LineStudyPlotStyle.Circles:S.append(new P(g)),w&&S.append(new _.PaneRendererLine({...(0,d.deepCopy)(g),lineWidth:1,ignorePaletteLineWidth:!0}));break;case L.LineStudyPlotStyle.StepLine:case L.LineStudyPlotStyle.StepLineWithBreaks:case L.LineStudyPlotStyle.StepLineWithDiamonds:{const e=new p.PaneRendererStepLine;e.setData({...g,decoration:o.plottype.value()===L.LineStudyPlotStyle.StepLineWithDiamonds?p.StepLineDecoration.Diamonds:p.StepLineDecoration.None,extendToBarsEndings:this._extendStepLineToBarsEndings}),S.append(e);break}default:S.append(new _.PaneRendererLine(g))}this._model.selection().isSelected(this._study)&&this._isMarkersEnabled&&this._selectionData&&S.append(new m.SelectionRenderer(this._selectionData))}_updateAdditionalPrices(e,t){var i;const s=null===(i=this._study.metaInfo().styles)||void 0===i?void 0:i[this._plotName];void 0!==(null==s?void 0:s.histogramBase)&&(this._histogramBase=e.priceToCoordinate(s.histogramBase,t))}}},249121:(e,t,i)=>{i.d(t,{StudyForceOverlayPlotView:()=>s});class s{constructor(e,t,i){this._series=e,this._model=t,this._plotName=i}isForceOverlay(){return!!this._study.metaInfo().isPlotForceOverlay(this._plotName)}_priceScale(){return this.isForceOverlay()?this._model.mainSeries().priceScale():this._study.priceScale()}}},337827:(e,t,i)=>{i.d(t,{StudyPaneViewInplaceUpdatable:()=>c});var s=i(650151),l=i(86441),o=i(181530),n=i(518439),a=i(828473),r=i(836687),d=i(509078),h=i(249121);class c extends h.StudyForceOverlayPlotView{constructor(e,t,i){super(e,t,i),this._selectionData=null,this._dataInvalidated=null,this._viewportInvalidated=!1,this._items=[],this._selectionIndexer=new r.SelectionIndexes(t.timeScale())}update(e){if("global-change"===e.type)return this._dataInvalidated=(0,o.mergeDataInvalidation)(this._dataInvalidated,{}),void(this._viewportInvalidated=!0);if("data-source-change"!==e.type)this._viewportInvalidated=!0;else{if((e.sourceId===this._study.id()||this._dependsOnSeriesData()&&e.sourceId===this._model.mainSeries().id())&&!e.nonSeriesOnly){const t=(0,o.mergeDataInvalidation)(this._dataInvalidated,{firstIndex:e.firstUpdatedTimePointIndex,clearData:e.clearData});this._dataInvalidated=t}}}_dependsOnSeriesData(){return!1}_makeSureRendererIsValid(){
this._dataInvalidated?this._updateImplFull(this._viewportInvalidated)&&(this._dataInvalidated=null):this._viewportInvalidated&&this._updateImplLight(),this._viewportInvalidated=!1}_preallocateItems(e,t){var i,l;const o=e.size(),n=null===(i=this._dataInvalidated)||void 0===i?void 0:i.firstIndex;if(0===o)return n;const r=this._study.offset(this._plotName);if(o!==this._items.length){const i=void 0!==n?n+r:void 0;if(void 0===i||0===this._items.length||i<(0,s.ensureDefined)(this._items[0].timePointIndex))return this._items=[],e.each(((e,i)=>{const s=i[this._plotIndex+1];return this._items.push(t(e,s)),!1})),this._items.length?(0,s.ensureDefined)(this._items[0].timePointIndex)-r:void 0;{const i=(0,s.ensureDefined)(n),o=r>=0?0:r,d=r>=0?r:0;let h=(0,a.lowerbound)(this._items,i+o,((e,t)=>e.timePointIndex<t));const c=(0,s.ensureNotNull)(e.lastIndex()),u=e.rangeIterator(i-d,c);for(const e of u)if(void 0!==h&&(null===(l=this._items[h])||void 0===l?void 0:l.timePointIndex)===e.index+r)h=this._updateItem(e,h);else{const i=e.value[this._plotIndex+1];this._items.push(t(e.index,i))}}}else if(void 0!==n){const t=r>=0?0:r,i=r>=0?r:0;let l=(0,a.lowerbound)(this._items,n+t,((e,t)=>e.timePointIndex<t));const o=(0,s.ensureNotNull)(e.lastIndex())+1,d=e.rangeIterator(n-i,o);for(const e of d)l=this._updateItem(e,l)}return n}_updateItem(e,t){const i=this._getValueForUpdating(e);return this._items[t].origPrices.price=null!=i?i:NaN,t+1}_getValueForUpdating(e){return e.value[this._plotIndex+1]}_calculateStartEnd(e){const t=this._study.offset(this._plotName);let i=e.firstBar()-Math.abs(t)-1,l=e.lastBar()+Math.abs(t)+1;const o=this._study.getMinFirstBarIndexForPlot(this._plotName)+t;if(o>l+1)return{startBar:null,endBar:null};let a=this._study.plots();a=a.range(o,(0,s.ensureNotNull)(a.lastIndex())),i=Math.max(i,o),l=Math.max(l,o);const r=a.search(i,n.PlotRowSearchMode.NearestLeft,this._plotIndex+1),d=a.search(l,n.PlotRowSearchMode.NearestRight,this._plotIndex+1);return null!==r&&(i=r.index),null!==d&&(l=d.index),i=Math.max(o,i),{startBar:i,endBar:l}}_updateImplLight(){const e=this._study.firstValue(void 0,this.isForceOverlay());if(null===e)return this._selectionData=null,void this._updateRenderer(0,-1);const t=this._priceScale();if(null===t||t.isEmpty())return this._selectionData=null,void this._updateRenderer(0,-1);const i=this._model.timeScale().visibleBarsStrictRange();if(null===i)return this._selectionData=null,void this._updateRenderer(0,-1);const{startBar:s,endBar:l}=this._calculateStartEnd(i);if(null===s||null===l||0===this._items.length)return this._selectionData=null,void this._updateRenderer(0,-1);const{startItemIndex:o,endItemIndex:n}=this._correctVisibleItemIndexes(Math.max(0,(0,a.lowerbound)(this._items,s,((e,t)=>e.timePointIndex<t))),Math.min(this._items.length,(0,a.upperbound)(this._items,l,((e,t)=>e<t.timePointIndex))));if(o>=n)return this._selectionData=null,void this._updateRenderer(0,-1);this._convertItemsToCoordinates(t,e,o,n),this._createSelection(e),this._updateRenderer(o,n)}_correctVisibleItemIndexes(e,t){return{
startItemIndex:e,endItemIndex:t}}_convertItemsToCoordinates(e,t,i,s){this._convertItemsToCoordinatesImpl(e,t,i,s)}_convertItemsToCoordinatesImpl(e,t,i,s){for(let e=i;e<s;e++){const t=this._items[e];t.y=t.origPrices.price}e.pointsArrayToCoordinates(this._items,t,{startItemIndex:i,endItemIndex:s}),this._model.timeScale().fillBarBorders(this._items,{startItemIndex:i,endItemIndex:s},!0),this._updateAdditionalPrices(e,t)}_updateAdditionalPrices(e,t){}_createSelection(e){const t=this._priceScale();if(null!==t)if(this._model.selection().isSelected(this._study)){const i=this._selectionIndexer.indexes(),o=(0,s.ensureNotNull)(this._model.paneForSource(this._study)).height();this._selectionData={points:[],bgColors:[],visible:!0,hittestResult:d.HitTarget.Regular,barSpacing:this._model.timeScale().barSpacing()};const n=this._study.offset(this._plotName);for(let s=0;s<i.length;s++){let a=i[s];const r=this._study.plots().valueAt(a);if(a+=n,null===r)continue;const d=r[this._plotIndex+1];if(null==d)continue;const h=this._model.timeScale().indexToCoordinate(Math.floor(a)),c=t.priceToCoordinate(d,e);this._selectionData.points.push(new l.Point(h,c)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(c/o))}}else this._selectionIndexer.clear()}}},125624:(e,t,i)=>{i.d(t,{StudyPriceAxisView:()=>n});var s=i(650151),l=i(347808),o=i(432059);class n extends l.PriceAxisView{constructor(e,t){super(),this._model=e.model(),this._source=e,this._data=t,this._isForceOverlay=!!this._source.metaInfo().isPlotForceOverlay(this._data.plotIndex)}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const l=this._source.model(),n=this._isForceOverlay?l.mainSeries().priceScale():this._source.priceScale();if(null===n)return;if(!l.isPriceScaleVisible(n))return;const a=this._source.lastValueData(this._data.plotIndex,!1);if(a.noData)return;const r=l.timeScale().visibleBarsStrictRange(),d=l.mainSeries().bars().lastIndex();if(null!==r&&null!==d){if(d<=r.lastBar()){i.background=(0,o.resetTransparency)(a.color);let s=a.color;"transparent"===s&&(s=this._model.properties().childs().scalesProperties.childs().backgroundColor.value()),i.textColor=this.generateTextColor(s),i.borderColor=void 0,e.borderVisible=!1,t.borderVisible=!1}else{const n=l.backgroundColorAtYPercentFromTop(a.coordinate/(0,s.ensureNotNull)(l.paneForSource(this._source)).height());i.background=n,i.textColor=(0,o.resetTransparency)(a.color),i.borderColor=(0,o.resetTransparency)(i.textColor),e.borderVisible=!0,t.borderVisible=!0}i.coordinate=a.coordinate,i.floatCoordinate=a.floatCoordinate,this._showAxisLabel()&&(e.text=a.text,e.visible=!0),this._updatePaneRendererData(t)}}_showPaneLabel(){const e=this._model.properties().childs().scalesProperties.childs();return(e.showStudyPlotLabels.value()||e.showFundamentalNameLabel.value())&&this._source.properties().childs().showLabelsOnPriceScale.value()&&this._source.isPlotVisibleAt(this._data.plotIndex,4)}_showAxisLabel(){const e=this._model.properties().childs().scalesProperties.childs()
;return(e.showStudyLastValue.value()||e.showFundamentalLastValue.value())&&this._source.properties().childs().showLabelsOnPriceScale.value()&&this._source.isPlotVisibleAt(this._data.plotIndex,4)}_updatePaneRendererData(e){e.text="",this._showPaneLabel()&&(e.text=this._source.priceLabelText(this._data.plotIndex),e.visible=!0)}}}}]);