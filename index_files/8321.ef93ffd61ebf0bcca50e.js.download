(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[8321,80717],{850775:(t,e,s)=>{"use strict";s.d(e,{mediaState:()=>l});var i=s(685459),o=s.n(i),n=s(411963),a=s(207678),r=s(76107);class h extends(o()){constructor(){super(),this.width=0,this.height=0,this.device=null,this.breakpoints=a.breakpoints,this._checkDevice(),window.addEventListener("resize",this._checkDevice),Object.entries(a.breakpoints).sort((([t,e],[s,i])=>e-i)).forEach((([t,e],s,i)=>{let o;if(0!==s){const[,t]=i[s-1];o=t+1}else o=0;const n=(0,r.matchMediaMinMax)(o,e);n.matches&&this._setNewDevice(t),n.addEventListener("change",(e=>{e.matches&&(this._checkDevice(),this._setNewDevice(t))}))})),(0,n.whenDocumentReady)(this._checkDevice.bind(this)),this.isPhoneSizeDevice.bind(this)}isPhoneSizeDevice(){return"phone"===this.device||"phone-vertical"===this.device}_checkDevice(){this.width=window.innerWidth,this.height=window.innerHeight}_setNewDevice(t){const e=this.device;this.device=t,this.trigger("changeDevice",[t,e])}}const l=new h},787703:(t,e,s)=>{"use strict";s.r(e),s.d(e,{isThemeExist:()=>d,loadTheme:()=>a,loadThemes:()=>r,removeTheme:()=>l,saveTheme:()=>h});var i=s(702598);const o=(0,s(338619).getLogger)("Themes.Provider");let n=null;function a(t){return(0,i.fetch)("/theme/?themeName="+encodeURIComponent(t),{credentials:"include",method:"GET"}).then((t=>t.json())).then((t=>{const e={};return t.content&&(e.content=JSON.parse(t.content)),e}))}function r(){return n||(0,i.fetch)("/themes/",{credentials:"include",method:"GET"}).then((t=>(n=t.json(),n)))}function h(t,e){const s=new FormData;return s.append("content",JSON.stringify(e)),s.append("name",t),n=null,(0,i.fetch)("/save-theme/",{credentials:"include",method:"POST",body:s}).then((t=>t.json()),(t=>o.logError(t)))}function l(t){const e=new FormData;return e.append("name",t),n=null,(0,i.fetch)("/remove-theme/",{credentials:"include",method:"POST",body:e}).then((t=>t.json()),(t=>o.logError(t)))}function d(t){return a(t).then((t=>Boolean(t.content)))}},278855:(t,e,s)=>{"use strict";function i(){return/(?:^|;)\s*theme=(dark|light)(?:;|$)|$/.exec(document.cookie)[1]}function o(t){const e=function(){const t=location.hostname.split(".").filter(Boolean);return t.every(isFinite)?location.host:t.slice(-2).join(".")}(),s=void 0===t?-1:3e8;document.cookie=`theme=${t};path=/;domain=${e};max-age=${s}`}s.d(e,{getThemeFromCookie:()=>i,setThemeToCookie:()=>o})},601526:(t,e,s)=>{"use strict";s.d(e,{parseTzOffset:()=>o});var i=s(870045);function o(t,e=Date.now()){const s=(0,i.get_timezone)(t).offset_utc(e);let o="";const n=s/1e3/60/60;n%1&&(o=":"+Math.round(Math.abs(n%1*60)).toString().padStart(2,"0"));let a="";return a=n>0?"+"+(n-n%1)+o:0===n?"":String(n-n%1+o),{offset:s,string:"UTC"+a}}},558150:(t,e,s)=>{"use strict";s.d(e,{clientSnapshot:()=>D,widgetClientSnapshot:()=>F});var i,o,n=s(743068),a=s(650151),r=s(86441),h=s(724377),l=s(919346),d=s(828473),c=s(631088),u=s(511275),m=s(694852),_=s(429874),g=s(287489),f=(s(764829),s(776351))
;const v=Boolean(null===(o=null===(i=window.initData)||void 0===i?void 0:i.logo)||void 0===o?void 0:o.no_powered_by);function p(t,e=null,s=null){let i={};if("number"==typeof t)return{relativePositions:{[t]:{l:e,t:s}},nextElementLeft:t,nextElementTop:t};const[o,...n]=t;if("v"===o){let t=null;for(const o of n){const n=p(o,e,s);i={...i,...n.relativePositions},s=n.nextElementTop,t=n.nextElementLeft}e=t}if("h"===o){let t=null;for(const o of n){const n=p(o,e,s);i={...i,...n.relativePositions},e=n.nextElementLeft,t=n.nextElementTop}s=t}return{relativePositions:i,nextElementTop:s,nextElementLeft:e}}const b=function(t){const e={};for(const s of Object.keys(t)){const i=p(t[s]).relativePositions;e[s]=i}return e}(g);function S(t,e,s,i){let o=Math.round(10*i),n=Math.round(10*i);const a=s[t];if(null!==a.l){const t=S(a.l,e,s,i);o=t.x+t.width+Math.round(5*i)}if(null!==a.t){const t=S(a.t,e,s,i);n=t.y+t.height+Math.round(5*i)}const r=e[t];return{x:o,y:n,width:r.width,height:r.height}}function y(t,e,s){var i;const o=(new DOMParser).parseFromString(f,"image/svg+xml");null===(i=null==o?void 0:o.firstElementChild)||void 0===i||i.setAttribute("color",s);const n=URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(o)],{type:"image/svg+xml"}));return new Promise((s=>{const i=new Image;i.width=t,i.height=e,i.onload=()=>{s({image:i,width:t,height:e})},i.src=n}))}function x(t,e,s,i,o){t.save(),t.drawImage(i.image,e,s,i.width,i.height),t.textBaseline="bottom";const n=(e+i.width)/o+3,a=(s+i.height)/o;(0,c.drawScaled)(t,o,o,(()=>{t.fillText("TradingView",n,a)})),t.restore()}function w(t,e,s,i){return(0,c.drawScaled)(t,i,i,(()=>{t.fillText(s,e.x/i,e.y/i)})),t.measureText(s).width*i}function I(t,e,s,i,o,n){const a=o.map((t=>t.text)).join("");let h=s.x;const l=function(t,e,s,i){if(t.measureText(e).width*i<=s)return{text:e,elided:!1};const o=t.measureText("...").width*i,n=[];for(let t=0;t<e.length;++t)n.push(t);const a=(0,d.upperbound)(n,s,((n,a)=>t.measureText(e.slice(0,a+1)).width*i+o>s));return{text:(e=e.slice(0,a)).trim(),elided:!0}}(t,a,i-h,e);if(l.elided&&!n)return null;const c=[];let u=0;for(const t of o){if(u+t.text.length>l.text.length)break;c.push(t.text),u+=t.text.length}const m=c.join("").trim().length;u=0;for(const i of o){if(u+i.text.length>m)break;i.color&&(t.save(),t.fillStyle=i.color),h+=w(t,new r.Point(h,s.y),i.text,e),i.color&&t.restore(),u+=i.text.length}return l.elided&&(h+=w(t,new r.Point(h,s.y),"...",e)),h}function T(t){return t.map((t=>({...t,title:""})))}function C(t,e){const s=[{text:t.trim()}];for(const t of e)t.visible&&(""!==s[s.length-1].text&&s.push({text:"  "}),t.title&&s.push({text:t.title}),s.push({text:t.value,color:t.color}));return s}class k{constructor(t,e){this._logoTextColor=null,this._snapshotData=t,e=e||{},this._options={backgroundColor:_.themes[t.theme].getThemedColor("color-bg-primary"),borderColor:_.themes[t.theme].getThemedColor("color-border"),font:u.CHART_FONT_FAMILY,fontSize:12,legendMode:"vertical",hideResolution:!1,hideStudiesFromLegend:!1,showHeaderPublishedBy:!1,
showHeaderMainSymbol:!1,...e};const s=b[t.layout],i=t.charts.map((t=>function(t){const e=t.panes[0],s=e.canvas.width+e.leftAxis.canvas.width+e.rightAxis.canvas.width;let i=0;for(const e of t.panes)i+=e.canvas.height;return void 0!==t.timeAxis&&0!==t.timeAxis.contentHeight&&(i+=t.timeAxis.canvas.height),(0,n.size)({width:s,height:i})}(t)));if(this._pixelRatio=t.hidpiRatio,this._chartsGeometry=t.charts.map(((t,e)=>S(e,i,s,this._pixelRatio))),!v){let s=t.theme;void 0!==e.backgroundColor&&(s="black"===(0,h.rgbToBlackWhiteString)((0,h.parseRgb)(e.backgroundColor),150)?l.StdTheme.Dark:l.StdTheme.Light),this._logoTextColor=_.themes[s].getThemedColor("color-text-primary")}this._headerDefaultTextColor=_.themes[t.theme].getThemedColor("color-text-primary")}async getImage(){const t=this._pixelRatio;let e=0,s=0,i=0;const o=this._headerItems();if(o.length>0){i=Math.ceil(1.4*this._options.fontSize*t)*o.length}s+=i;let a=0,h=0;for(const t of this._chartsGeometry)a=Math.max(a,t.x+t.width),h=Math.max(h,t.y+t.height);const l=s;e+=a,s+=h,e+=Math.round(10*t);const d=v?Math.round(10*t):Math.round(35*t),_=s;s+=d;const g=(0,c.createDisconnectedCanvas)(document,(0,n.size)({width:e,height:s}),1),f=(0,c.getContext2D)(g);f.font=(0,m.makeFont)(this._options.fontSize,this._options.font),f.textBaseline="top",f.fillStyle=this._options.backgroundColor,f.fillRect(0,0,e,s),o.length>0&&this._drawHeader(f,o,e,new r.Point(Math.round(10*t),Math.round(10*t)));for(let t=0;t<this._snapshotData.charts.length;++t){const e=this._snapshotData.charts[t],s=this._chartsGeometry[t];this._drawChart(e,s,f,new r.Point(0,l))}if(null!==this._logoTextColor){const e=await y(Math.round(20*t),Math.round(15*t),this._logoTextColor);f.fillStyle=this._logoTextColor,f.font=(0,m.makeFont)(13,u.CHART_FONT_FAMILY);const s=_+Math.round(d/2-e.height/2);x(f,Math.round(10*t),s,e,t)}return g}_drawChart(t,e,s,i){s.save(),s.translate(e.x+i.x,e.y+i.y);let o=0;for(const e of t.panes){let i=0;const n=e.leftAxis.canvas.width+Math.round(8*this._pixelRatio),a=o,h=o+Math.round(10*this._pixelRatio);e.leftAxis.contentWidth>0&&e.leftAxis.contentHeight>0&&(s.drawImage(e.leftAxis.canvas,i,o),i+=e.leftAxis.canvas.width),s.drawImage(e.canvas,i,o),i+=e.canvas.width,e.rightAxis.contentWidth>0&&e.rightAxis.contentHeight>0&&s.drawImage(e.rightAxis.canvas,i,o),"pane"===e.type&&(s.fillStyle=t.colors.text,this._drawLegend(e,s,new r.Point(n,h),a)),o+=e.canvas.height}if(void 0!==t.timeAxis&&0!==t.timeAxis.contentHeight){let e=0;t.timeAxis.lhsStub.contentWidth>0&&t.timeAxis.lhsStub.contentHeight>0&&(s.drawImage(t.timeAxis.lhsStub.canvas,e,o),e+=t.timeAxis.lhsStub.canvas.width),s.drawImage(t.timeAxis.canvas,e,o),e+=t.timeAxis.canvas.width,t.timeAxis.rhsStub.contentWidth>0&&t.timeAxis.rhsStub.contentHeight>0&&s.drawImage(t.timeAxis.rhsStub.canvas,e,o)}s.strokeStyle=this._options.borderColor,s.strokeRect(0,0,e.width,e.height),s.restore()}_headerItems(){var t,e,s,i;const o=[];if(this._options.showHeaderPublishedBy&&this._snapshotData.publishedBy)for(const t of this._snapshotData.publishedBy)o.push([{text:t}])
;if(this._options.showHeaderMainSymbol){const n=this._snapshotData.charts[0],a=`${null===(t=n.meta)||void 0===t?void 0:t.symbol}, ${null===(e=n.meta)||void 0===e?void 0:e.resolution}`;o.push(C(a,null!==(i=null===(s=n.meta)||void 0===s?void 0:s.values)&&void 0!==i?i:[]))}return o}_drawHeader(t,e,s,i){t.save(),t.fillStyle=this._headerDefaultTextColor;const o=Math.ceil(1.4*this._options.fontSize*this._pixelRatio);e.forEach(((e,n)=>{I(t,this._pixelRatio,new r.Point(i.x,i.y+o*n),s,e,!0)})),t.restore()}_drawLegend(t,e,s,i){let o=!0;const n=Math.ceil(1.4*this._options.fontSize*this._pixelRatio);let h=s.x,l=s.y;if(t.mainSeriesText&&l+n<i+t.canvas.height){const s=I(e,this._pixelRatio,new r.Point(h,l),t.contentWidth*this._pixelRatio,C(t.mainSeriesText,t.mainSeriesValues),!0);"horizontal"!==this._options.legendMode?l+=n:(h=(0,a.ensureNotNull)(s)+1.4*this._options.fontSize*this._pixelRatio,o=!1)}for(let a=0;a<t.studies.length;++a)if(l+n<i+t.canvas.height){const i=t.studies[a],d=t.studiesValues[a];let c=null;for(;null===c;)c=I(e,this._pixelRatio,new r.Point(h,l),t.contentWidth*this._pixelRatio,this._options.hideStudiesFromLegend?[]:C(i,T(d)),o),"horizontal"!==this._options.legendMode?l+=n:null===c?(o=!0,h=s.x,l+=n):(h=c+1.4*this._options.fontSize*this._pixelRatio,o=!1)}}}async function D(t,e){return new k(t,e).getImage()}class M{constructor(t,e){if(this._logoTextColor=null,this._widgetSnapshot=t,e=e||{},this._options={backgroundColor:_.themes[t.theme].getThemedColor("color-bg-primary"),borderColor:_.themes[t.theme].getThemedColor("color-border"),font:u.CHART_FONT_FAMILY,fontSize:12,showHeaderPublishedBy:!0,...e},this._pixelRatio=t.hidpiRatio,!v){let s=t.theme;void 0!==e.backgroundColor&&(s="black"===(0,h.rgbToBlackWhiteString)((0,h.parseRgb)(e.backgroundColor),150)?l.StdTheme.Dark:l.StdTheme.Light),this._logoTextColor=_.themes[s].getThemedColor("color-text-primary")}this._headerDefaultTextColor=_.themes[t.theme].getThemedColor("color-text-primary")}async getImage(){const t=this._pixelRatio,e=Math.round(10*t);let s=0,i=0,o=0;const a=this._headerItems();if(a.length>0){o=Math.ceil(1.4*this._options.fontSize*t)*a.length}i+=o;const h=i,l=this._widgetSnapshot.canvas.width,d=this._widgetSnapshot.canvas.height;s+=l+2*e,i+=d+e;const _=Math.round(35*t),g=i;i+=_;const f=(0,c.createDisconnectedCanvas)(document,(0,n.size)({width:s,height:i}),1),v=(0,c.getContext2D)(f);if(v.font=(0,m.makeFont)(this._options.fontSize,this._options.font),v.textBaseline="top",v.fillStyle=this._options.backgroundColor,v.fillRect(0,0,s,i),a.length>0&&this._drawHeader(v,a,s,new r.Point(e,e)),v.drawImage(this._widgetSnapshot.canvas,e,e+h),v.strokeStyle=this._options.borderColor,v.strokeRect(e,e+h,l,d),null!==this._logoTextColor){const s=await y(Math.round(20*t),Math.round(15*t),this._logoTextColor);v.fillStyle=this._logoTextColor,v.font=(0,m.makeFont)(13,u.CHART_FONT_FAMILY);x(v,e,g+Math.round(_/2-s.height/2),s,t)}return f}_headerItems(){const t=[]
;if(this._options.showHeaderPublishedBy&&this._widgetSnapshot.publishedBy)for(const e of this._widgetSnapshot.publishedBy)t.push([{text:e}]);return t}_drawHeader(t,e,s,i){t.save(),t.fillStyle=this._headerDefaultTextColor;const o=Math.ceil(1.4*this._options.fontSize*this._pixelRatio);e.forEach(((e,n)=>{I(t,this._pixelRatio,new r.Point(i.x,i.y+o*n),s,e,!0)})),t.restore()}}async function F(t,e){return new M(t,e).getImage()}},319448:(t,e,s)=>{"use strict";s.d(e,{DateTimeFormatter:()=>a});var i=s(300484),o=s(553220);const n={dateFormat:"yyyy-MM-dd",withWeekday:!1,timeFormat:i.hourMinuteSecondFormat,dateTimeSeparator:" "};class a{constructor(t={}){const e=Object.assign({},n,t);this._dateFormatter=new o.DateFormatter(e.dateFormat,e.withWeekday),this._timeFormatter=new i.TimeFormatter(e.timeFormat),this._separator=e.dateTimeSeparator}format(t){return`${this._dateFormatter.format(t)}${this._separator}${this._timeFormatter.format(t)}`}formatLocal(t){return`${this._dateFormatter.formatLocal(t)}${this._separator}${this._timeFormatter.formatLocal(t)}`}}},430719:(t,e,s)=>{"use strict";s.d(e,{DateTimeWithTzFormatter:()=>l});var i=s(601526),o=s(870045),n=s(300484),a=s(319448),r=s(553220);const h={dateFormat:"MMM dd",timeFormat:n.hourMinuteFormat};class l{constructor(t={}){const{dateFormat:e,timeFormat:s,timezone:i}={...h,...t};e&&s?this._dateFormatter=new a.DateTimeFormatter({dateFormat:e,timeFormat:s}):e?this._dateFormatter=new r.DateFormatter(e):s&&(this._dateFormatter=new n.TimeFormatter(s)),this._timezone=(0,o.get_timezone)(null!=i?i:"Etc/UTC")}format(t){const e=1e3*t,s=(0,i.parseTzOffset)(this._timezone.name(),e).string;return void 0===this._dateFormatter?s:`${this._dateFormatter.format((0,o.utc_to_cal)(this._timezone,e))} ${s}`}setTimezone(t){this._timezone=(0,o.get_timezone)(t)}}},501372:(t,e,s)=>{"use strict";s.d(e,{SeriesDataSource:()=>y,initialRequestOptionsToNumBars:()=>p,parseJapaneseProjectionBars:()=>x});var i=s(650151),o=s(124829),n=s(882782),a=s(378975),r=s(368628),h=s(979351),l=s(124066),d=s(320771),c=s(338619),u=s(975179),m=s(61625);const _=(0,c.getLogger)("Chart.SeriesDataSource");var g;!function(t){t[t.Idle=0]="Idle",t[t.AwaitingConnection=1]="AwaitingConnection",t[t.AwaitingFirstDataUpdate=2]="AwaitingFirstDataUpdate",t[t.Active=3]="Active"}(g||(g={}));let f=1;let v=1;function p(t){return t.startDate?t.endDate||t.count?t.endDate?["from_to",t.startDate,t.endDate]:["bar_count",t.startDate,(0,i.ensure)(t.count)]:["from_to",t.startDate]:t.count||300}function b(t){return(0,o.isString)(t.symbol)?t.symbol:t.symbol.symbol}function S(t,e){(0,o.isString)(t.symbol)?t.symbol=e:t.symbol.symbol=e}class y{constructor(t,e,s,i){this._extSymbol=null,this._lastResolvedSymbol="",this._createSeriesOverriddenParams=0,this._instanceId=null,this._symbolInstanceId=null,this._resolution=null,this._timeFrame=null,this._data=new r.SeriesData,this._dataEvents=new d.SeriesDataEvents,this._status=g.Idle,this._turnaroundCounter=1,this._boundOnGatewayIsConnectedChanged=this._onGatewayIsConnectedChanged.bind(this),
this._ongoingDataUpdate=Promise.resolve(),this._gateway=t,this._turnaroundPrefix=e,this._createSeriesParams=p(null!=s?s:{count:300}),this._timeFrame=i||null,this._gateway.isConnected().subscribe(this._boundOnGatewayIsConnectedChanged)}destroy(){this.stop(),this._gateway.isConnected().unsubscribe(this._boundOnGatewayIsConnectedChanged)}modifySeries(t,e,s=null,n=!1,r=null){n&&(_.logNormal("Due to force flag clearing symbol & resolution to force re-requesting data."),this._extSymbol=null,this._resolution=null);const h=b(t),l=!this.symbolSameAsResolved(h);if(l&&(this._lastResolvedSymbol=""),this._extSymbol&&!l){S(t,b(this._extSymbol))}const d=this._extSymbol,c=this._resolution;if(this._extSymbol=t,this._resolution=e,null===this._instanceId)return void(this._timeFrame=s);const u=!(0,o.deepEquals)(d,t)[0];u&&S(this._extSymbol,h);const m=null===c||!a.Interval.isEqual(c,e);(u||m||null!==s)&&(this._timeFrame=null,(u||m)&&this._turnaroundCounter++,u&&this._resolveSymbol(),this._gateway.modifySeries(this._instanceId,this.turnaround(),(0,i.ensureNotNull)(this._symbolInstanceId),this._resolution,r,s,this._onMessage.bind(this)),this._dataEvents.fireModified())}requestMoreData(t){null!==this._instanceId&&this._gateway.requestMoreData(this._instanceId,t,this._onMessage.bind(this))}requestMoreTickmarks(t){null!==this._instanceId&&this._gateway.requestMoreTickmarks(this._instanceId,t,this._onMessage.bind(this))}setFutureTickmarksMode(t){null!==this._instanceId&&this._gateway.setFutureTickmarksMode(t)}isStarted(){return this._status!==g.Idle}isActive(){return this._status===g.Active}resolution(){return this._resolution}start(){this.isStarted()?_.logNormal("start: data source is already started, nothing to do"):((0,i.assert)(null!==this._extSymbol,"symbol must be set before start"),(0,i.assert)(null!==this._resolution,"resolution must be set before start"),this._gateway.isConnected().value()?this._createSeries():this._changeStatusTo(g.AwaitingConnection))}stop(){this.isStarted()?(null!==this._instanceId&&(this._gateway.removeSeries(this._instanceId),this._instanceId=null),this._symbolInstanceId=null,this._changeStatusTo(g.Idle)):_.logNormal("stop: data source is already stopped, nothing to do")}instanceId(){return this._instanceId}data(){return this._data}setData(t){this._data=t}clearData(){this.isStarted()?this._enqueueUpdate((()=>this._clearDataImpl())):this._clearDataImpl()}dataEvents(){return this._dataEvents}turnaround(){return`${this._turnaroundPrefix}${this._turnaroundCounter}`}symbolInstanceId(){return this._symbolInstanceId}symbol(){return this._extSymbol}moveData(t){this._enqueueUpdate((()=>this._data.moveData(t)))}setInitialRequestOptions(t){this._createSeriesOverriddenParams=p(t)}symbolSameAsResolved(t){return null!==this._extSymbol&&(0,m.symbolSameAsResolved)(t,b(this._extSymbol),this._lastResolvedSymbol)}resolvedSymbol(){return null===this._extSymbol?null:b(this._extSymbol)}_resolveSymbol(){null!==this._extSymbol&&(this._symbolInstanceId=this._gateway.resolveSymbol("sds_sym_"+f++,(0,
n.encodeExtendedSymbolOrGetSimpleSymbolString)(this._extSymbol),this._onMessage.bind(this)))}_clearDataImpl(){this._data.clear()}_changeStatusTo(t){(0,i.assert)(this._status!==t,"Source and destination status should be distinct"),_.logNormal(`Status changed from ${g[this._status]} to ${g[t]}`),this._status=t}_createSeries(){(0,i.assert)(this._status!==g.Active,'Status should not be "Active" when creating a study'),this._instanceId="sds_"+v++,this._resolveSymbol();const t=this._createSeriesOverriddenParams||this._createSeriesParams;this._createSeriesOverriddenParams&&(this._createSeriesOverriddenParams=0),this._gateway.createSeries(this._instanceId,this.turnaround(),(0,i.ensureNotNull)(this._symbolInstanceId),(0,i.ensureNotNull)(this._resolution),t,this._timeFrame,this._onMessage.bind(this)),this._timeFrame=null,this._changeStatusTo(g.AwaitingFirstDataUpdate),this._dataEvents.fireCreated(this._instanceId)}_onGatewayIsConnectedChanged(t){t?this._onGatewayConnected():this._onGatewayDisconnected()}_onGatewayConnected(){this._status===g.AwaitingConnection&&this._createSeries()}_onGatewayDisconnected(){this._status!==g.Idle&&this._status!==g.AwaitingConnection&&(this._instanceId=null,this._changeStatusTo(g.AwaitingConnection)),this._turnaroundCounter=1}_onMessage(t){this._enqueueUpdate((()=>this._onMessageImpl(t)))}async _onMessageImpl(t){switch(t.method){case"symbol_resolved":{const[e,s]=t.params;if(e!==this._symbolInstanceId){null!==this._symbolInstanceId&&_.logNormal(`Resolve for old symbol, expected: ${this._symbolInstanceId}, actual ${t.params[0]}`);break}this._onSymbolResolved(s);break}case"symbol_error":if(t.params[0]!==this._symbolInstanceId){null!==this._symbolInstanceId&&_.logNormal(`Symbol error for old symbol, expected: ${this._symbolInstanceId}, actual ${t.params[0]}`);break}this._onSymbolError(t);break;case"series_timeframe":{const[e,s,i,o,n,a,r]=t.params;if(!this._checkTurnaround(e,s)){_.logNormal(`Time frame for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${s})`);break}this._onSeriesTimeFrame(i,o,n,a,r);break}case"series_error":{const[e,s]=t.params;if(!this._checkTurnaround(e,s)){_.logNormal(`Series error for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${s})`);break}this._onSeriesError(t.params[2]);break}case"series_loading":{const[e,s]=t.params;if(!this._checkTurnaround(e,s))break;this._onSeriesLoading(t.time);break}case"series_completed":{const[e,s,i,o]=t.params;if(!this._checkTurnaround(e,i)){_.logNormal(`Series completed for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${e} (${i})`);break}this._onSeriesCompleted(s,t.time,o);break}case"data_update":if(!this._checkTurnaround(t.params.customId,t.params.turnaround)){_.logNormal(`Data update for old data, expected: ${this._symbolInstanceId} (${this.turnaround()}), actual ${t.params.customId} (${t.params.turnaround})`);break}await this._onDataUpdate(t.params.plots,t.params.nonseries,t.params.lastBar);break;case"clear_data":
if(t.params.turnaround!==this.turnaround()){_.logNormal(`Clear data for old data, expected: ${this.turnaround()}, actual ${t.params.turnaround}`);break}this._clearDataImpl(),this._dataEvents.fireDataUpdated(void 0,!1,null,!1)}}_onSeriesError(t){let e,s;if("string"==typeof t)s={error:t},e=t;else if(s=t,t.ctx){const s={};Object.entries(t.ctx).forEach((([t,e])=>{s[t]=e.toString()})),e=t.error.format(s)}else e=t.error;if(e.startsWith("study_not_auth:")){const t=e.split(":",2)[1].split("@",2)[0];if(["BarSetRenko","BarSetPriceBreak","BarSetKagi","BarSetPnF"].includes(t))this._dataEvents.fireChartTypeNotPermitted(t);else if("BarSetSpread"===t)this._dataEvents.fireIntradaySpreadNotPermitted();else if("BarSetRange"===t){const t=`${(0,i.ensureNotNull)(this._extSymbol).inputs.range}R`;this._dataEvents.fireCustomIntervalNotPermitted(t)}}else{if(e.startsWith("unsupported"))return void this._dataEvents.fireUnsupportedResolutionRequested();"resolution_not_entitled"===e?this._dataEvents.fireIntradayExchangeNotPermitted():"custom_resolution"===e?this._dataEvents.fireCustomIntervalNotPermitted((0,i.ensureNotNull)(this._resolution)):"seconds_not_entitled"===e?this._dataEvents.fireSecondsIntervalNotPermitted():"ticks_not_entitled"===e&&this._dataEvents.fireTicksIntervalNotPermitted()}this._dataEvents.fireSeriesError(s)}_onSeriesTimeFrame(t,e,s,i,o){this._dataEvents.fireSeriesTimeFrame(t,e,s,null==i||i,o)}_onSymbolError(t){if(t.params[1]===l.permissionDenied)switch(t.params[2]){case l.SymbolErrorPermissionDeniedReason.Symbol:this._dataEvents.fireSymbolNotPermitted(t.params[3]);break;case l.SymbolErrorPermissionDeniedReason.GroupPermission:this._dataEvents.fireSymbolGroupNotPermitted(t.params[3]);break;default:this._dataEvents.fireSymbolNotPermitted(t.params[2])}else t.params[1]===l.invalidSymbol&&this._dataEvents.fireSymbolInvalid();this._dataEvents.fireSymbolError(t.params[1])}_onSymbolResolved(t){this._lastResolvedSymbol=(0,i.ensureNotNull)((0,u.extractSymbolNameFromSymbolInfo)(t,"")),this._dataEvents.fireSymbolResolved(t)}async _onDataUpdate(t,e,s){this._onDataUnpacked(t,s,await x(e))}_enqueueUpdate(t){return this._ongoingDataUpdate=this._ongoingDataUpdate.then(t,t),this._ongoingDataUpdate}_onDataUnpacked(t,e,s){if(this._status===g.Idle)return;this._status===g.AwaitingFirstDataUpdate&&(this._changeStatusTo(g.Active),this._clearDataImpl());const i=this._data.bars().size(),o=this._data.bars().firstIndex(),n=this._data.mergeRegularBars(t);null!==s&&(this._data.nsBars().clear(),this._data.nsBars().merge(s.projectionPlots),this._data.lastProjectionPrice=s.lastPrice,null!==s.boxSize&&(this._data.boxSize=s.boxSize),this._data.reversalAmount=s.reversalAmount);const a=null===o,r=a||null!==n&&n.index<o;this._dataEvents.fireDataUpdated(e,r,n,a),i!==this._data.bars().size()&&null!==n&&this._dataEvents.fireBarReceived(n)}_onSeriesLoading(t){this._dataEvents.fireLoading(t)}_onSeriesCompleted(t,e,s){this._dataEvents.fireCompleted({updateMode:t,time:e,flags:s})}_checkTurnaround(t,e){return this._instanceId===t&&(void 0===e||e===this.turnaround())}}
async function x(t){if(void 0===t)return{projectionPlots:[],boxSize:null};if(""===t.d||"nochange"===t.indexes)return null;const e=await(0,h.unpackNonSeriesData)(t.d);if(null===e||e.indexes_replace)return null;const s=t.indexes,{bars:i,price:o,boxSize:n,reversalAmount:a}=e.data;return{lastPrice:o,projectionPlots:(i||[]).map((t=>{let e;return"factor"in t?e=t.factor:"additionalPrice"in t&&(e=t.additionalPrice),{index:s[t.time],value:[0,t.open,t.high,t.low,t.close,t.volume,e]}})),reversalAmount:a,boxSize:n}}},69184:(t,e,s)=>{"use strict";s.d(e,{getHourMinuteFormat:()=>o,getHourMinuteSecondFormat:()=>n,getTimeFormatForInterval:()=>a});var i=s(300484);function o(t){return"12-hours"===t?i.twelveHourMinuteFormat:i.hourMinuteFormat}function n(t){return"12-hours"===t?i.twelveHourMinuteSecondFormat:i.hourMinuteSecondFormat}function a(t,e){if(t.isRange())return function(t){return"12-hours"===t?i.twelveHourMinuteNonZeroSecondFormat:i.hourMinuteNonZeroSecondFormat}(e);if(t.isTicks())return i.hourMinuteSecondMillisecFormat;return t.isSeconds()||t.isTicks()?n(e):o(e)}},776351:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 28" width="36" height="28"><path fill="currentColor" d="M14 22H7V11H0V4h14v18zM28 22h-8l7.5-18h8L28 22z"/><circle fill="currentColor" cx="20" cy="8" r="4"/></svg>'},287489:t=>{"use strict";t.exports=JSON.parse('{"4":["v",["h",0,2],["h",1,3]],"6":["v",["h",0,2,4],["h",1,3,5]],"8":["v",["h",0,2,4,6],["h",1,3,5,7]],"2h":["h",0,1],"2v":["v",0,1],"2-1":["v",["h",0,2],1],"3s":["h",0,["v",1,2]],"3h":["h",0,1,2],"3v":["v",0,1,2],"1-2":["v",0,["h",1,2]],"3r":["h",["v",0,1],2],"4h":["h",0,1,2,3],"4v":["v",0,1,2,3],"4s":["h",0,["v",1,2,3]],"4s-l":["h",["v",1,2,3],0],"5h":["h",0,1,2,3,4],"5v":["v",0,1,2,3,4],"6h":["h",0,1,2,3,4,5],"6v":["v",0,1,2,3,4,5],"7h":["h",0,1,2,3,4,5,6],"8h":["h",0,1,2,3,4,5,6,7],"8v":["v",0,1,2,3,4,5,6,7],"9h":["h",0,1,2,3,4,5,6,7,8],"9v":["v",0,1,2,3,4,5,6,7,8],"10h":["h",0,1,2,3,4,5,6,7,8,9],"10v":["v",0,1,2,3,4,5,6,7,8,9],"1-3":["v",0,["h",1,2,3]],"2-2":["v",["h",0,1],["v",2,3]],"2-2-l":["h",0,1,["v",2,3]],"2-3":["v",["h",0,1],["h",2,3,4]],"3-2":["v",["h",0,1,2],["h",3,4]],"1-4":["v",0,["h",1,2,3,4]],"2-4":["v",["h",0,1],["h",2,3,4,5]],"5s":["h",0,["v",1,2,3,4]],"6c":["v",["h",0,1],["h",2,3],["h",4,5]],"8c":["v",["h",0,1],["h",2,3],["h",4,5],["h",6,7]],"9s":["v",["h",0,1,2],["h",3,4,5],["h",6,7,8]],"10c5":["v",["h",0,2,4,6,8],["h",1,3,5,7,9]],"12c6":["v",["h",0,2,4,6,8,10],["h",1,3,5,7,9,11]],"12c4":["v",["h",0,4,8],["h",1,5,9],["h",2,6,10],["h",3,7,11]],"14c7":["v",["h",0,2,4,6,8,10,12],["h",1,3,5,7,9,11,13]],"16c8":["v",["h",0,2,4,6,8,10,12,14],["h",1,3,5,7,9,11,13,15]],"16c4":["v",["h",0,4,8,12],["h",1,5,9,13],["h",2,6,10,14],["h",3,7,11,15]],"s":0}')}}]);